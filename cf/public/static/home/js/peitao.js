/** * 百度地图 */var BMapApplication = {    'map' : null,                      // 百度地图实例    'panorama' : null,                 // 街景地图实例    'sPoint' : null,                   // 基础地图坐标点实例    'pPoint' : null,                   // 街景地图坐标点    'pageSize' : 10,                    // 分页条数    'count' : 0,                       // 搜索结果统计    'resultList' : [],                 // 搜索结果列表    'listShowState' : true,            // 搜索结果列表的显示状态    /**     * 初始化方法     * @param lng     * @param lat     * @param elemId     */    'init' : function (args){        var lng = args.lng ? args.lng : 0;        var lat = args.lat ? args.lat : 0;        var mapContainerId = args.mapContainerId ? args.mapContainerId : '';        var streetContainerId = args.streetContainerId ? args.streetContainerId : '';        if (mapContainerId != '')        {            this.setBmapContainer(mapContainerId);            this.setSPoint(lng, lat);        }        if (streetContainerId != '')        {            this.setPanoramaContainer(streetContainerId);            this.setPPoint(lng, lat);        }    },    /**     * 设置基本地图容器     * @param elemId     */    'setBmapContainer' : function (elemId){        elemId = elemId == undefined ? 'allmap' : elemId;        this.map = (this.map == null) ? new BMap.Map(elemId) : this.map;    },    /* 清空基本地图容器 */    'clearBmapContainer' : function (){        this.map = null;    },    /**     * 设置街景地图容器     * @param elemId     */    'setPanoramaContainer' : function (elemId){        this.panorama = (this.panorama == null) ? new BMap.Panorama(elemId, {            albumsControl: true    // 显示相册控件        }) : this.panorama;    },    /**     * 设置经纬坐标点     * @param lng     * @param lat     */    'setSPoint' : function (lng, lat){        this.sPoint = (this.sPoint == null) ? new BMap.Point(lng, lat) : this.sPoint;    },    /**     * 设置     * @param lng     * @param lat     */    'setPPoint' : function (lng, lat){        this.pPoint = (this.pPoint == null) ? new BMap.Point(lng, lat) : this.pPoint;    },    /**     * 得到圆的内接正方形bounds     * @param {Point} centerPoi 圆形范围的圆心     * @param {Number} r 圆形范围的半径     * @return 无返回值     */    'getSquareBounds' : function (centerPoi, r){        var a = Math.sqrt(2) * r;    // 正方形边长        mPoi = this.getMecator(centerPoi);        var x0 = mPoi.x, y0 = mPoi.y;        var x1 = x0 + a / 2 , y1 = y0 + a / 2;    // 东北点        var x2 = x0 - a / 2 , y2 = y0 - a / 2;    // 西南点        var ne = this.getPoi(new BMap.Pixel(x1, y1)), sw = this.getPoi(new BMap.Pixel(x2, y2));        return new BMap.Bounds(sw, ne);    },    /**     * 根据球面坐标获得平面坐标     * @param poi     * @returns {*}     */    'getMecator' : function (poi){        return this.map.getMapType().getProjection().lngLatToPoint(poi);    },    /**     * 根据平面坐标获得球面坐标     * @param mecator     * @returns {*}     */    'getPoi' : function (mecator){        return this.map.getMapType().getProjection().pointToLngLat(mecator);    },    /**     * 搜索结果显示到页面上     * @param keyword 关键词     * @param result  搜索结果     * @param iconFlagClass 显示ICON标识     */    'showResultToPage' : function (keyword, result, box){        $('#'+box+'_total').text(result.length);        var str = '';        if (result.length > 0)        {            for(var i = 0; i < result.length; i++)            {                var list = result[i].split(',');                str +=(i + 1) + '、';                str +=list[0]+'(<i>'+list[1] + '米</i>)&nbsp;&nbsp;';                $('#'+box+'_con').html(str);            }        }    },    /**     * 周边配套地图     * @param lng     * @param lat     * @param keyword     * @param box     * @param iconFlagClass 显示的ICON标识     */    'getAreaMap' : function (keyword, box){        var ePoint = '';                          // 搜索结果坐标点        var distance = 0;                         // 搜索结果距离目标点距离(单位/米)        var _this = this;                         // 解决闭包作用域问题        this.map.disableScrollWheelZoom();        this.map.centerAndZoom(this.sPoint,14);        this.map.clearOverlays();    // 清除页面标记        var circle = new BMap.Circle(this.sPoint, 3000, {fillColor:"blue", strokeWeight: 1 ,fillOpacity: 0.1, strokeOpacity: 0.1});        this.map.addOverlay(circle);    // 添加页面标记        var marker = new BMap.Marker(this.sPoint);          // 创建标注        this.map.addOverlay(marker);                        // 将标注添加到地图中        var top_left_navigation = new BMap.NavigationControl();        this.map.addControl(top_left_navigation);           // 添加缩放比例        var options = {            onSearchComplete: function(results){                _this.resultList = [];    // 清空搜索结果集合                // 判断状态是否正确                if (local.getStatus() == BMAP_STATUS_SUCCESS)                {                    _this.count = results.getCurrentNumPois();                    for (var i = 0; i < results.getCurrentNumPois(); i ++)                    {                        ePoint = new BMap.Point(results.getPoi(i).point.lng, results.getPoi(i).point.lat);                        distance = parseInt(_this.map.getDistance(_this.sPoint, ePoint));                        _this.resultList.push(results.getPoi(i).title + ', ' + distance);                    }                }                _this.showResultToPage(results.keyword, _this.resultList, box);            },            pageCapacity: this.pageSize,            renderOptions : {                map : _this.map,                'autoViewport' : false            }        };        var local = new BMap.LocalSearch(this.map, options);        var bounds = this.getSquareBounds(circle.getCenter(), circle.getRadius());        local.searchInBounds(keyword, bounds);    }};